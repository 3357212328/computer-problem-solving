从 **F401** 切换到 **F407ZGT6** 或其他 STM32F4 芯片，逻辑上和 F1 的迁移是一样的，但 F4 有几个独特的坑（比如主频、时钟频率和复杂的引脚复用）。

你需要修改以下 **4 个核心部分**：

---

### 1. 修改 EIDE 芯片选型与宏定义

1.  **EIDE 选型**：在 EIDE 面板点击芯片图标，重新搜索并选择 `STM32F407ZG`。
2.  **修改宏定义**：
    *   打开 `Core/stm32f4xx.h`。
    *   取消注释 `#define STM32F40_41xxx`（这是 F405/407 所在的系列宏）。
    *   **同时**：记得在 EIDE 的 **全局宏定义** 选项里，把 `STM32F401xE` 删掉，换成 `STM32F40_41xxx`。

---

### 2. 更换启动文件 (.s)

不同系列的 F4 中断向量表不同，必须更换：
*   **F407**：使用 `startup_stm32f40_41xxx.s`。
*   **F429**：使用 `startup_stm32f429_439xx.s`。
*   **F411**：使用 `startup_stm32f411xe.s`。

> 可以在库目录 `Libraries\CMSIS\Device\ST\STM32F4xx\Source\Templates\gcc_ride7` 下找到这些文件。

---

### 3. 修改链接脚本 (.ld)

F407ZGT6 的资源是 **1MB Flash** 和 **192KB RAM**（实际上是 128KB 主 SRAM + 64KB CCM RAM，通常我们先用那 128KB）。

**修改 `MEMORY` 部分如下：**

```c
/* F407ZGT6 的配置 */
MEMORY
{
  RAM (xrw)      : ORIGIN = 0x20000000, LENGTH = 128K  /* 先用主SRAM */
  FLASH (rx)     : ORIGIN = 0x08000000, LENGTH = 1024K /* 1MB */
}
/* 栈顶地址 = 0x20000000 + 128*1024 */
_estack = 0x20020000; 
```

---

### 4. 关键：修正时钟频率 (HSE_VALUE) —— 最大的坑

**这是很多 F407 开发板串口乱码、延时不对的根本原因。**

1.  **查看板子晶振**：看看你的 F407 板子上焊的金属晶振是 **8MHz** 还是 **25MHz**。
2.  **修改头文件**：打开 `Core/stm32f4xx.h`，搜索 `HSE_VALUE`。
    *   标准库默认通常是 `25000000` (25MHz)。
    *   **如果你的板子是 8MHz**，必须把这个值改成 `8000000`。
3.  **修改 System 文件**：打开 `Core/system_stm32f4xx.c`，搜索 `PLL_M`。
    *   公式是：`VCO输入 = HSE / PLL_M`。
    *   ST 官方建议 VCO 输入为 1MHz。
    *   如果你是 **8MHz** 晶振，`PLL_M` 应该改为 **8**。
    *   如果你是 **25MHz** 晶振，`PLL_M` 应该改为 **25**。

---

### 常见 F4 芯片参数速查表

| 芯片型号 | 宏定义 | Flash | RAM | 主频 | 启动文件 (.s) |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **F401RE** | `STM32F401xE` | 512K | 96K | 84MHz | `startup_stm32f401xx.s` |
| **F407ZG** | `STM32F40_41xxx` | 1024K | 192K* | 168MHz | `startup_stm32f40_41xxx.s` |
| **F411CE** | `STM32F411xE` | 512K | 128K | 100MHz | `startup_stm32f411xe.s` |
| **F429IG** | `STM32F429_439xx` | 1024K | 256K | 180MHz | `startup_stm32f429_439xx.s` |

---

### 总结：迁移三部曲

1.  **改 LD 文件**：调整 `LENGTH` 和 `_estack`（根据 RAM 大小计算）。
2.  **改宏定义**：在 `stm32f4xx.h` 里开关对应的 `#define`。
3.  **检查晶振**：确保 `HSE_VALUE` 和 `PLL_M` 与你板子上的实物晶振频率匹配。

**代码层面**：
*   F4 全系列的驱动库（GPIO, UART, ADC等）几乎是通用的。
*   唯一的区别是某些高型号有更多的串口（串口 4/5/6）或更多的引脚（Port G/H/I），只要你在 `main.c` 里初始化的引脚在你的芯片上存在，代码就不需要动。